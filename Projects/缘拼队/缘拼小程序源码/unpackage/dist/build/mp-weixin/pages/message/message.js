(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/message"],{"283b":function(e,t,n){},3136:function(e,t,n){"use strict";n.r(t);var a=n("5355"),o=n("42a6");for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);n("bef9");var r,c=n("f0c5"),i=Object(c["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);t["default"]=i.exports},"36f7":function(e,t,n){"use strict";(function(e){n("7b0f");a(n("66fd"));var t=a(n("3136"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"42a6":function(e,t,n){"use strict";n.r(t);var a=n("8651"),o=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=o.a},5355:function(e,t,n){"use strict";var a,o=function(){var e=this,t=e.$createElement;e._self._c},s=[];n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a}))},8651:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("e03f"));function o(e){return e&&e.__esModule?e:{default:e}}var s={created:function(){},data:function(){return{val0:"",val1:"",val2:"",val3:"",placeholder:"动态占位内容",nickName:"",avataUrl:"",conversation:[],id:"",deleteId:"",searchBar:"searchBar",searchContent:"",showStatus:!1,search:"search",search_placeholder:"请输入搜索内容"}},onLoad:function(){this.$rongyun();var t=this,n=e.getStorageSync("openId");e.getStorageSync("nickName"),e.getStorageSync("avatarUrl");e.request({url:"https://zmetalhearty.com/yuanpin/Ronglogin",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{userId:n},success:function(n){var o=n.data.token;a.default.RongIMClient.connect(o,{onSuccess:function(n){console.log("连接成功, 用户 id 为",n),e.setStorageSync("userId",n);var o=[a.default.ConversationType.PRIVATE],s=150;a.default.RongIMClient.getInstance().getConversationList({onSuccess:function(n){console.log("获取会话列表成功",n);var a=JSON.stringify(n);e.request({url:"https://zmetalhearty.com/yuanpin/FrontTools",method:"POST",header:{"content-type":"application/x-www-form-urlencoded;charset=utf-8"},data:{json:a},success:function(n){console.log("上传会话成功");for(var a=n.data,o=0;o<a.length;o++){var s=t.changeTime(a[o].sentTime);a[o].sentTime=s,"ImageMessage"==a[o].latestMessage.messageType?a[o].latestMessage.content.content="[图片]":"FileMessage"==a[o].latestMessage.messageType&&(a[o].latestMessage.content.content="[语音]")}t.$store.commit("updateConver",a),e.setStorageSync("conversation",a),t.conversation=t.$store.state.conversation}})},onError:function(e){console.log("获取会话列表失败",e)}},o,s)},onTokenIncorrect:function(){console.log("连接失败, 失败原因: token 无效")},onError:function(e){var t="";switch(e){case a.default.ErrorCode.TIMEOUT:t="链接超时";break;case a.default.ConnectionState.UNACCEPTABLE_PAROTOCOL_VERSION:t="不可接受的协议版本";break;case a.default.ConnectionState.IDENTIFIER_REJECTED:t="appkey 不正确";break;case a.default.ConnectionState.SERVER_UNAVAILABLE:t="服务器不可用";break;default:t=e;break}console.log("连接失败, 失败原因: ",t)}})}})},onShow:function(){e.setStorageSync("msgTargetId",0);var t=e.getStorageSync("conversation");this.$store.commit("updateConver",t),this.conversation=this.$store.state.conversation},onHide:function(){this.deleteId=""},onUnload:function(){this.deleteId=""},methods:{sear:function(){var t=this.searchContent;if(""==t&&e.request({url:"https://zmetalhearty.com/yuanpin/HomeItemsOperator",method:"POST",header:{"content-type":"application/x-www-form-urlencoded;charset=utf-8"},data:{operation:"searchHomeItem",name:t},success:function(t){if(t.data.search!=[]){var n=JSON.stringify(t.data.search);e.navigateTo({url:"/pages/resault/resault?array="+n})}else t.data.search==[]&&e.showToast({title:"搜索无结果！",icon:"none",duration:1e3})}}),""!=t)if(isNaN(Number(t)))e.showToast({title:"请输入用户名进行搜索",icon:"none",duration:1e3});else if("number"==typeof Number(t)){var n=e.getStorageSync("ID");e.request({url:"https://zmetalhearty.com/yuanpin/GetUserInfoInRong",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{Focus:n,ID:t},success:function(t){1==t.data.code?e.navigateTo({url:"../info/info?targetName="+t.data.nickname+"&targetId="+t.data.ID+"&avatarUrl="+t.data.img+"&sex="+t.data.sex+"&type="+t.data.status}):0==t.data.code&&e.showToast({title:"搜索无结果！",icon:"none",duration:1e3})}})}this.searchContent=""},searchCon:function(e){this.searchContent=e.detail.value,0!=this.searchContent.length?this.search_placeholder="":this.search_placeholder="请输入搜索内容"},searchBarChange:function(){this.search="search",this.showStatus=!1},searchFocus:function(){this.search="search_hover",this.showStatus=!0},delStatus:function(){this.deleteId=""},changeTime:function(e){var t=new Date(e),n=t.getMonth()+1;n=n<10?"0"+n:n;var a=t.getDate();a=a<10?"0"+a:a;var o=t.getHours();o=o<10?"0"+o:o;var s=t.getMinutes();return s=s<10?"0"+s:s,n+"-"+a+" "+o+":"+s},deleteCon:function(e){""==this.deleteId?this.deleteId=e:this.deleteId=""},delConver:function(){var t=this,n=a.default.ConversationType.PRIVATE,o=this.deleteId;a.default.RongIMClient.getInstance().removeConversation(n,o,{onSuccess:function(n){console.log("删除指定会话成功");for(var a=t.$store.state.conversation,s=0;s<a.length;s++)a[s].targetId==o&&(a.splice(s,1),t.$store.commit("updateConver",a),e.setStorageSync("conversation",a))},onError:function(e){console.log("删除指定会话失败",e)}})},talk:function(t,n){this.showDelete=!1;var o=a.default.ConversationType.PRIVATE,s=t,r=0,c=e.getStorageSync("ID");console.log(s),a.default.RongIMClient.getInstance().getConversation(o,s,{onSuccess:function(e){e&&console.log("获取指定会话成功",e)}});for(var i=0;i<this.conversation.length;i++)r+=this.conversation[i].unreadMessageCount;r-=this.conversation[n].unreadMessageCount,r=r.toString(),r>0?e.showTabBarRedDot({index:2}):0==r&&e.hideTabBarRedDot({index:2}),this.conversation[n].unreadMessageCount=0,e.setStorageSync("conversation",this.conversation);o=a.default.ConversationType.PRIVATE;a.default.RongIMClient.getInstance().clearUnreadCount(o,s,{onSuccess:function(){console.log("清除指定会话未读消息数成功")},onError:function(e){console.log("清除指定会话未读消息数失败",e)}}),e.request({url:"https://zmetalhearty.com/yuanpin/GetUserInfoInRong",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{Focus:c,ID:s},success:function(t){1==t.data.code&&e.navigateTo({url:"../HM-chat/HM-chat?avatarUrl="+t.data.img+"&uName="+t.data.nickname+"&targetId="+t.data.ID+"&fromPin=0"})}})}}};t.default=s}).call(this,n("543d")["default"])},bef9:function(e,t,n){"use strict";var a=n("283b"),o=n.n(a);o.a}},[["36f7","common/runtime","common/vendor"]]]);