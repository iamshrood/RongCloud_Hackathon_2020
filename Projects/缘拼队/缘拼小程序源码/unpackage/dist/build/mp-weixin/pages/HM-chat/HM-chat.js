(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/HM-chat/HM-chat"],{"2d3d":function(t,e,s){"use strict";s.r(e);var n=s("ca82"),o=s("a5d8");for(var a in o)"default"!==a&&function(t){s.d(e,t,(function(){return o[t]}))}(a);s("363a");var r,i=s("f0c5"),g=Object(i["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);e["default"]=g.exports},"363a":function(t,e,s){"use strict";var n=s("8bce"),o=s.n(n);o.a},"439b":function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(s("e03f"));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(){s.e("components/uni-popup/uni-popup").then(function(){return resolve(s("7e3a"))}.bind(null,s)).catch(s.oe)},r={data:function(){return{textMsg:"",space:"",getFocus:!1,isHistoryLoading:!1,scrollAnimation:!1,scrollTop:0,scrollToView:"",msgList:[],msgImgList:[],myuid:0,targetId:"",RECORDER:t.getRecorderManager(),isVoice:!1,voiceTis:"按住 说话",recordTis:"手指上滑 取消发送",recording:!1,willStop:!1,initPoint:{identifier:0,Y:0},recordTimer:null,recordLength:0,AUDIO:t.createInnerAudioContext(),playMsgid:null,VoiceTimer:null,popupLayerClass:"",hideMore:!0,hideEmoji:!0,emojiList:[[{url:"0.png",alt:"[微笑]"},{url:"1.png",alt:"[伤心]"},{url:"2.png",alt:"[高兴]"},{url:"3.png",alt:"[有些不爽]"},{url:"4.png",alt:"[不舒服]"},{url:"5.png",alt:"[亲亲]"},{url:"6.png",alt:"[生气]"},{url:"7.png",alt:"[流泪]"},{url:"8.png",alt:"[无语]"},{url:"9.png",alt:"[吐舌笑]"},{url:"10.png",alt:"[惊吓]"},{url:"11.png",alt:"[流汗]"},{url:"12.png",alt:"[小声]"},{url:"13.png",alt:"[气的冒烟]"},{url:"14.png",alt:"[戴口罩]"},{url:"15.png",alt:"[疑问]"},{url:"16.png",alt:"[紧张]"},{url:"17.png",alt:"[呕吐]"},{url:"18.png",alt:"[面无表情]"},{url:"19.png",alt:"[祝贺]"},{url:"20.png",alt:"[泪眼]"},{url:"21.png",alt:"[白眼]"},{url:"22.png",alt:"[鬼脸]"},{url:"23.png",alt:"[哭笑不得]"}],[{url:"24.png",alt:"[发烧]"},{url:"25.png",alt:"[惊讶]"},{url:"26.png",alt:"[冻僵]"},{url:"27.png",alt:"[汗]"},{url:"28.png",alt:"[高兴]"},{url:"29.png",alt:"[眼冒金星]"},{url:"30.png",alt:"[嘟嘴]"},{url:"31.png",alt:"[大哭]"},{url:"32.png",alt:"[说谎]"},{url:"33.png",alt:"[想吐]"},{url:"34.png",alt:"[难过]"},{url:"35.png",alt:"[臭臭]"},{url:"36.png",alt:"[笑的流泪]"},{url:"37.png",alt:"[怒骂]"},{url:"38.png",alt:"[睡觉]"},{url:"39.png",alt:"[天使]"},{url:"40.png",alt:"[心动]"},{url:"41.png",alt:"[恶魔]"},{url:"42.png",alt:"[尴尬]"},{url:"43.png",alt:"[挤眼笑]"},{url:"44.png",alt:"[温馨]"},{url:"45.png",alt:"[说漏嘴]"},{url:"46.png",alt:"[酷]"},{url:"47.png",alt:"[拽]"}],[{url:"48.png",alt:"[思考]"},{url:"49.png",alt:"[不爽]"},{url:"50.png",alt:"[气的颠倒]"},{url:"51.png",alt:"[丧气]"},{url:"52.png",alt:"[wink]"},{url:"53.png",alt:"[哈欠]"},{url:"54.png",alt:"[噤声]"}]],onlineEmoji:{},windowsState:"",postId:-1,avatarUrl:"",myAvatarUrl:"",uName:"",myNickName:"",myId:"",Viewid:"",sendArray:[],sendEmpty:!1}},components:{uniPopup:a},watch:{msgList:function(t,e){var s=this,n=s.$store.state.pushStatus;if(n){var o=s.msgList.length-1;o>7&&(s.scrollToView=s.msgList[o].messageUId),s.$store.commit("changePush",!1)}}},onHide:function(){for(var e=this,s=0;s<e.$store.state.conversation.length;s++)if(e.$store.state.conversation[s].targetId==this.targetId){var o=e.$store.state.conversation;o[s].unreadMessageCount=0,e.$store.commit("updateConver",o)}t.setStorageSync("conversation",o),t.setStorageSync("msgTargetId",0);var a=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().clearUnreadCount(a,e.targetId,{onSuccess:function(){console.log("清除指定会话未读消息数成功")},onError:function(t){console.log("清除指定会话未读消息数失败",t)}})},onUnload:function(){for(var e=this,s=0;s<e.$store.state.conversation.length;s++)if(e.$store.state.conversation[s].targetId==this.targetId){var o=e.$store.state.conversation;o[s].unreadMessageCount=0,e.$store.commit("updateConver",o)}t.setStorageSync("conversation",o),t.setStorageSync("msgTargetId",0);var a=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().clearUnreadCount(a,e.targetId,{onSuccess:function(){console.log("清除指定会话未读消息数成功")},onError:function(t){console.log("清除指定会话未读消息数失败",t)}})},onLoad:function(e){var s=this;this.myId=t.getStorageSync("ID"),this.avatarUrl=e.avatarUrl,this.uName=e.uName,t.setNavigationBarTitle({title:this.uName}),this.myNickName=t.getStorageSync("nickName"),this.myAvatarUrl=t.getStorageSync("avatarUrl"),this.targetId=e.targetId;var o=this;t.setStorageSync("msgTargetId",this.targetId),this.$rongyun();var a=t.getStorageSync("openId");t.getStorageSync("nickName"),t.getStorageSync("avatarUrl");t.request({url:"https://zmetalhearty.com/yuanpin/Ronglogin",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{userId:a},success:function(t){var e=t.data.token;n.default.RongIMClient.connect(e,{onSuccess:function(t){console.log("连接成功, 用户 id 为",t)},onTokenIncorrect:function(){console.log("连接失败, 失败原因: token 无效")},onError:function(t){var e="";switch(t){case n.default.ErrorCode.TIMEOUT:e="链接超时";break;case n.default.ConnectionState.UNACCEPTABLE_PAROTOCOL_VERSION:e="不可接受的协议版本";break;case n.default.ConnectionState.IDENTIFIER_REJECTED:e="appkey 不正确";break;case n.default.ConnectionState.SERVER_UNAVAILABLE:e="服务器不可用";break;default:e=t;break}console.log("连接失败, 失败原因: ",e)}})}});var r=t.getStorageSync("msgList"+this.targetId);t.getStorageSync("sendStatus");if(0==r.length){var i=n.default.ConversationType.PRIVATE,g=null,c=20;n.default.RongIMClient.getInstance().getHistoryMessages(i,o.targetId,g,c,{onSuccess:function(e,s){console.log("获取历史消息成功");for(var n=JSON.stringify(e),a=JSON.parse(n),r=0;r<a.length;r++)"TextMessage"==a[r].messageType&&"pin"!=a[r].content.extra.type&&"system"!=a[r].content.extra.type&&(a[r].content.extra=o.replaceEmoji(a[r].content.content));o.$store.commit("updateMsg",a),o.msgList=o.$store.state.msgList;for(var i=!1,g=0;g<o.msgList.length;g++)"ImageMessage"==o.msgList[g].messageType&&(o.msgList[g].content.imageUri,1)&&(o.msgImgList.push(o.msgList[g].content.imageUri),i=!0);i&&(o.$store.commit("updateImg",o.msgImgList),o.msgList=o.$store.state.msgList);var c={messageType:"getPin",content:"点击发起缘拼，或从右下角加号 => 缘拼图标 发起"};o.$store.commit("pushMsg",c),o.$nextTick((function(){o.scrollTop=99999,o.$nextTick((function(){o.scrollAnimation=!0}))})),t.setStorageSync("msgList"+o.targetId,o.$store.state.msgList)},onError:function(t){console.log("获取历史消息失败",t)}})}else{for(var l=t.getStorageSync("msgList"+o.targetId),u=0;u<l.length;u++)"TextMessage"==l[u].messageType&&"pin"!=l[u].content.extra.type&&"system"!=l[u].content.extra.type&&(l[u].content.extra=o.replaceEmoji(l[u].content.content)),"ImageMessage"==l[u].messageType&&(l[u].content.imageUri,1)&&o.msgImgList.push(l[u].content.imageUri);o.$store.commit("updateMsg",l),o.$store.commit("updateImg",o.msgImgList),o.msgList=o.$store.state.msgList,o.msgImgList=o.$store.state.msgImgList;var m={messageType:"getPin",content:"点击发起缘拼，或从右下角加号 => 缘拼图标 发起"};o.$store.commit("pushMsg",m),o.$nextTick((function(){o.scrollTop=99999,o.$nextTick((function(){o.scrollAnimation=!0}))}))}this.AUDIO.onEnded((function(t){s.playMsgid=null})),this.RECORDER.onStart((function(t){s.recordBegin(t)})),this.RECORDER.onStop((function(t){s.recordEnd(t)}))},onShow:function(){var e=this;e.$nextTick((function(){e.scrollTop=9999,e.$nextTick((function(){e.scrollAnimation=!0})),t.setStorageSync("pushStatus",!1)}))},methods:{agree:function(e){var s=this;t.request({url:"https://zmetalhearty.com/yuanpin/HomeItemsOperator",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{operation:"addPartake",itemID:e,UserID:this.targetId,status:"2"},success:function(e){t.showToast({title:"缘拼成功~",icon:"success",duration:1e3});var o=s,a=new n.default.TextMessage({content:"[缘拼成功]",extra:{type:"system",content:"缘拼成功！请到 我的缘拼->我参与的 中查看"}}),r=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().sendMessage(r,o.targetId,a,{onSuccess:function(e){console.log("发送文本消息成功",e);var s=o.msgList.length-1;o.$store.commit("pushMsg",e);for(var n=!1,a=0;a<o.$store.state.conversation.length;a++)o.$store.state.conversation[a].targetId==o.targetId&&(n=!0);if(n){for(var r=0;r<o.$store.state.conversation.length;r++)if(o.$store.state.conversation[r].targetId==o.targetId){var i=o.$store.state.conversation;i[r].latestMessage.content.content=e.content.content;var g=o.changeTime(i[r].sentTime);i[r].sentTime=g,o.$store.commit("updateConver",i),t.setStorageSync("conversation",i)}t.setStorageSync("msgList"+o.targetId,o.$store.state.msgList),t.setStorageSync("msgImgList"+o.targetId,o.$store.state.msgImgList);s=o.msgList.length-1;s>7&&(o.scrollToView=o.msgList[s].messageUId)}else o.findCon()},onError:function(t){console.log("发送文本消息失败",t)}})}})},hidePop:function(){this.$refs.popup.close()},choose:function(e){var s=function(){var t=new Date,e=t.getMonth()+1,s=t.getDate(),n=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();e>=1&&e<=9&&(e="0"+e),s>=0&&s<=9&&(s="0"+s);var a=e+"-"+s+" "+n+":"+o;return a},o=this,a=new n.default.TextMessage({content:"[发起缘拼]",extra:{type:"pin",id:e.ID,title:e.title}}),r=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().sendMessage(r,o.targetId,a,{onSuccess:function(e){console.log("发送文本消息成功",e);var n=o.msgList.length-1,a=s(),r=(new Date).getTime();if(o.$store.state.msgList.length>1){n=o.$store.state.msgList.length-1;var i=r-o.$store.state.msgList[n].sentTime}if(i>=6e4){var g={messageType:"system",type:"time",content:a};o.$store.commit("pushMsg",g)}o.$store.commit("pushMsg",e),o.textMsg="";for(var c=!1,l=0;l<o.$store.state.conversation.length;l++)o.$store.state.conversation[l].targetId==o.targetId&&(c=!0);if(c){for(var u=0;u<o.$store.state.conversation.length;u++)if(o.$store.state.conversation[u].targetId==o.targetId){var m=o.$store.state.conversation;m[u].latestMessage.content.content=e.content.content;var d=o.changeTime(m[u].sentTime);m[u].sentTime=d,o.$store.commit("updateConver",m),t.setStorageSync("conversation",m)}t.setStorageSync("msgList"+o.targetId,o.$store.state.msgList),t.setStorageSync("msgImgList"+o.targetId,o.$store.state.msgImgList),o.$refs.popup.close();n=o.msgList.length-1;n>7&&(o.scrollToView=o.msgList[n].messageUId)}else o.findCon()},onError:function(t){console.log("发送文本消息失败",t)}})},jump:function(e){var s=this;"friend"==e&&t.request({url:"https://zmetalhearty.com/yuanpin/GetUserInfoInRong",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{Focus:s.myId,ID:s.targetId},success:function(e){1==e.data.code&&t.navigateTo({url:"../info/info?targetName="+e.data.nickname+"&targetId="+e.data.ID+"&avatarUrl="+e.data.img+"&sex="+e.data.sex+"&type="+e.data.status})}})},pin:function(){var e=this;t.request({url:"https://zmetalhearty.com/yuanpin/HomeItemsOperator",method:"POST",header:{"content-type":"application/x-www-form-urlencoded;charset=utf-8"},data:{operation:"getAllbyUserID",UserID:this.targetId},success:function(t){for(var s in t.data)var n=t.data[s];var o=n.length;if(0!=o)for(var a=0;a<o;a++)if(n[a].address){var r=JSON.parse(n[a].address);n[a].address=r}else{var i=JSON.parse(n[a].pstart);n[a].pstart=i;var g=JSON.parse(n[a].pend);n[a].pend=g}else e.sendEmpty=!0;e.sendArray=n}}),this.$refs.popup.open()},spaceStatus:function(){switch(t.getSystemInfoSync().platform){case"android":console.log("运行Android上"),this.space;break;case"ios":console.log("运行iOS上"),this.space;break;default:console.log("运行在开发者工具上");break}},screenMsg:function(e){if("system"==e.type)switch(e.msg.type){case"text":this.addSystemTextMsg(e);break;case"redEnvelope":this.addSystemRedEnvelopeMsg(e);break}else if("user"==e.type){switch(e.msg.type){case"text":this.addTextMsg(e);break;case"voice":this.addVoiceMsg(e);break;case"img":this.addImgMsg(e);break;case"redEnvelope":this.addRedEnvelopeMsg(e);break}console.log("用户消息"),e.msg.userinfo.uid!=this.myuid&&(console.log("振动"),t.vibrateLong())}that.$nextTick((function(){that.scrollTop=99999,that.$nextTick((function(){that.scrollAnimation=!0}))}))},loadHistory:function(e){var s=this;if(!this.isHistoryLoading){this.isHistoryLoading=!0,this.scrollAnimation=!1,0!=s.msgList.length&&(s.Viewid=s.msgList[0].messageUId);s=this;setTimeout((function(){var e=n.default.ConversationType.PRIVATE,o=null,a=20;n.default.RongIMClient.getInstance().getHistoryMessages(e,s.targetId,o,a,{onSuccess:function(e,n){console.log("获取历史消息成功"),0==n&&t.setStorageSync("hasMsg",0);var o=t.getStorageSync("hasMsg");if(0!=o){for(var a=JSON.stringify(e),r=JSON.parse(a),i=r.length-1;i>=0;i--)"undefined"!=typeof r[i]&&"TextMessage"==r[i].messageType?("pin"!=r[i].content.extra.type&&"system"!=r[i].content.extra.type&&(r[i].content.extra=s.replaceEmoji(r[i].content.content)),s.msgList.unshift(r[i])):"undefined"!=typeof r[i]&&"ImageMessage"==r[i].messageType&&s.msgImgList.unshift(r[i].content.imageUri);console.log(s.msgList)}else s.isHistoryLoading=!1},onError:function(t){console.log("获取历史消息失败",t)}});var r=s.msgList.length-1;r>7&&(s.scrollToView=s.Viewid)}),1e3)}},getMsgList:function(){},setPicSize:function(e){var s=t.upx2px(350),n=t.upx2px(350);if(e.w>s||e.h>n){var o=e.w/e.h;e.w=o>1?s:n*o,e.h=o>1?s/o:n}else 144==e.w&&144==e.h&&(e.w=25,e.h=25);return e},showMore:function(){this.isVoice=!1,this.hideEmoji=!0,this.hideMore?(this.hideMore=!1,this.openDrawer()):this.hideDrawer()},openDrawer:function(){this.popupLayerClass="showLayer"},hideDrawer:function(){var t=this;this.popupLayerClass="",setTimeout((function(){t.hideMore=!0,t.hideEmoji=!0}),150)},chooseImage:function(){this.getImage("album")},camera:function(){this.getImage("camera")},changeTime:function(t){var e=new Date(t),s=e.getMonth()+1;s=s<10?"0"+s:s;var n=e.getDate();n=n<10?"0"+n:n;var o=e.getHours();o=o<10?"0"+o:o;var a=e.getMinutes();return a=a<10?"0"+a:a,s+"-"+n+" "+o+":"+a},findCon:function(e){var s=this,o=e,a=[n.default.ConversationType.PRIVATE],r=150;n.default.RongIMClient.getInstance().getConversationList({onSuccess:function(e){console.log("获取会话列表成功",e);var n=e;console.log(n);for(var a=0;a<n.length;a++)n[a].sentTime=o,"ImageMessage"==n[a].latestMessage.messageType?n[a].latestMessage.content.content="[图片]":"FileMessage"==n[a].latestMessage.messageType&&(n[a].latestMessage.content.content="[语音]");s.$store.commit("updateConver",n),t.setStorageSync("conversation",n),s.conversation=s.$store.state.conversation;for(a=0;a<s.$store.state.conversation.length;a++)if(s.$store.state.conversation[a].targetId==s.targetId){var r=s.$store.state.conversation;r[a].latestMessage.content.content=message.content.content,s.$store.commit("updateConver",r),t.setStorageSync("conversation",r)}t.setStorageSync("msgList"+s.targetId,s.$store.state.msgList);var i=s.msgList.length-1;i>7&&(s.scrollToView=s.msgList[i].messageUId)},onError:function(t){console.log("获取会话列表失败",t)}},a,r)},getImage:function(e){var s=function(){var t=new Date,e=t.getMonth()+1,s=t.getDate(),n=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();e>=1&&e<=9&&(e="0"+e),s>=0&&s<=9&&(s="0"+s);var a=e+"-"+s+" "+n+":"+o;return a},o=this;this.hideDrawer(),t.chooseImage({sourceType:[e],sizeType:["original","compressed"],success:function(e){for(var a=0;a<e.tempFilePaths.length;a++)t.uploadFile({url:"https://zmetalhearty.com/yuanpin/MessageFileUpload",filePath:e.tempFilePaths[a],name:"file",formData:{"content-type":"application/x-www-form-urlencoded"},success:function(e){var a="https://zmetalhearty.com"+e.data,r=new n.default.ImageMessage({imageUri:a}),i=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().sendMessage(i,o.targetId,r,{onSuccess:function(e){console.log("发送图片消息成功",e);var n=o.msgList.length-1,a=s(),r=(new Date).getTime();if(o.$store.state.msgList.length>1){n=o.$store.state.msgList.length-1;var i=r-o.$store.state.msgList[n].sentTime}if(i>=6e4){var g={messageType:"system",type:"time",content:a};o.$store.commit("pushMsg",g)}o.$store.commit("pushMsg",e),o.$store.commit("pushImg",e.content.imageUri);for(var c=!1,l=0;l<o.$store.state.conversation.length;l++)o.$store.state.conversation[l].targetId==o.targetId&&(c=!0);if(c){for(var u=0;u<o.$store.state.conversation.length;u++)if(o.$store.state.conversation[u].targetId==o.targetId){var m=o.$store.state.conversation;m[u].latestMessage.content.content="[图片]",o.$store.commit("updateConver",m),t.setStorageSync("conversation",m)}t.setStorageSync("msgList"+o.targetId,o.$store.state.msgList);n=o.msgList.length-1;n>7&&(o.scrollToView=o.msgList[n].messageUId)}else o.findCon()},onError:function(t){console.log("发送图片消息失败",t)}})},fail:function(t){console.log("失败")}})}})},chooseEmoji:function(){this.hideMore=!0,this.hideEmoji?(this.hideEmoji=!1,this.openDrawer()):this.hideDrawer()},addEmoji:function(t){this.textMsg+=t.alt},textareaFocus:function(){"showLayer"==this.popupLayerClass&&0==this.hideMore&&this.hideDrawer()},getMoreTime:function(t){var e=new Date(t),s=e.getMonth()+1,n=e.getDate(),o=e.getHours()<10?"0"+e.getHours():e.getHours(),a=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes();s>=1&&s<=9&&(s="0"+s),n>=0&&n<=9&&(n="0"+n);var r=s+"-"+n+" "+o+":"+a;return r},sendText:function(){var e=function(){var t=new Date,e=t.getMonth()+1,s=t.getDate(),n=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();e>=1&&e<=9&&(e="0"+e),s>=0&&s<=9&&(s="0"+s);var a=e+"-"+s+" "+n+":"+o;return a},s=(e(),this);if(s.hideDrawer(),s.textMsg){this.replaceEmoji(s.textMsg);var o=new n.default.TextMessage({content:s.textMsg,extra:"附加信息"}),a=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().sendMessage(a,s.targetId,o,{onSuccess:function(n){console.log("发送文本消息成功",n),n.content.extra=s.replaceEmoji(n.content.content),console.log(n.content.extra);var o=s.msgList.length-1,a=(e(),(new Date).getTime());if(s.$store.state.msgList.length>1){o=s.$store.state.msgList.length-1;var r=a-s.$store.state.msgList[o].sentTime;if(r>=6e4){var i={messageType:"system",type:"time",content:s.getMoreTime(a)};s.$store.commit("pushMsg",i)}}s.$store.commit("pushMsg",n),s.textMsg="";for(var g=!1,c=0;c<s.$store.state.conversation.length;c++)s.$store.state.conversation[c].targetId==s.targetId&&(g=!0);if(g){for(var l=0;l<s.$store.state.conversation.length;l++)if(s.$store.state.conversation[l].targetId==s.targetId){u=s.$store.state.conversation;u[l].latestMessage.content.content=n.content.content;m=(new Date).getTime(),d=s.changeTime(m);u[l].sentTime=d,s.$store.commit("updateConver",u),t.setStorageSync("conversation",u)}t.setStorageSync("msgList"+s.targetId,s.$store.state.msgList),t.setStorageSync("msgImgList"+s.targetId,s.$store.state.msgImgList);o=s.msgList.length-1;o>7&&(s.scrollToView=s.msgList[o].messageUId)}else{var u=s.$store.state.conversation;u[l].latestMessage.content.content=n.content.content;var m=(new Date).getTime(),d=s.changeTime(m);s.findCon(d)}},onError:function(t){console.log("发送文本消息失败",t)}})}},replaceEmoji:function(t){var e=this,s=t.replace(/\[([^(\]|\[)]*)\]/g,(function(t,s){for(var n=0;n<e.emojiList.length;n++)for(var o=e.emojiList[n],a=0;a<o.length;a++){var r=o[a];if(r.alt==t){var i="https://zmetalhearty.com/yuanpin/emoji/",g='<img src="'+i+r.url+'" width="25upx" height="25upx" style="max-width:100%;">';return g}}}));return'<div style="vertical-align:middle;display: flex;align-items: center;flex-wrap: wrap;white-space: pre-wrap;word-break: break-all;">'+s+"</div>"},sendMsg:function(t,e){var s=new Date;if(this.msgList){this.msgList[this.msgList.length-1].msg.id;0}var n={type:"user",msg:{id:lastid,time:s.getHours()+":"+s.getMinutes(),type:e,userinfo:{uid:this.myuid,username:this.myNickName,face:this.myAvatarUrl},content:t}};this.screenMsg(n)},addTextMsg:function(t){this.msgList.push(t)},addVoiceMsg:function(t){this.msgList.push(t)},addImgMsg:function(t){t.msg.content=this.setPicSize(t.msg.content),this.msgImgList.push(t.msg.content.url),this.msgList.push(t)},addRedEnvelopeMsg:function(t){this.msgList.push(t)},addSystemTextMsg:function(t){this.msgList.push(t)},addSystemRedEnvelopeMsg:function(t){this.msgList.push(t)},showPic:function(e){t.previewImage({indicator:"default",current:e.imageUri,urls:this.msgImgList,success:function(t){console.log("预览成功")},fail:function(t){console.log(t)}})},playVoice:function(t){this.playMsgid=t.messageUId,this.AUDIO.src=t.content.fileUrl,this.$nextTick((function(){this.AUDIO.play()}))},voiceBegin:function(t){t.touches.length>1||(this.initPoint.Y=t.touches[0].clientY,this.initPoint.identifier=t.touches[0].identifier,this.RECORDER.start({format:"mp3"}))},recordBegin:function(t){var e=this;this.recording=!0,this.voiceTis="松开 结束",this.recordLength=0,this.recordTimer=setInterval((function(){e.recordLength++}),1e3)},voiceCancel:function(){this.recording=!1,this.voiceTis="按住 说话",this.recordTis="手指上滑 取消发送",this.willStop=!0,this.RECORDER.stop()},voiceIng:function(e){if(this.recording){var s=e.touches[0];this.initPoint.Y-s.clientY>=t.upx2px(100)?(this.willStop=!0,this.recordTis="松开手指 取消发送"):(this.willStop=!1,this.recordTis="手指上滑 取消发送")}},voiceEnd:function(t){this.recording&&(this.recording=!1,this.voiceTis="按住 说话",this.recordTis="手指上滑 取消发送",this.RECORDER.stop())},recordEnd:function(e){var s=function(){var t=new Date,e=t.getMonth()+1,s=t.getDate(),n=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();e>=1&&e<=9&&(e="0"+e),s>=0&&s<=9&&(s="0"+s);var a=e+"-"+s+" "+n+":"+o;return a},o=this;if(clearInterval(this.recordTimer),this.willStop)console.log("取消发送录音");else{e.tempFilePath;var a=parseInt(this.recordLength/60),r=this.recordLength%60;a=a<10?"0"+a:a,r=r<10?"0"+r:r;var i=a+":"+r,g=!1;0==a&&0==r&&(g=!0,t.showToast({title:"说话时间太短！",icon:"none"})),g||t.uploadFile({url:"https://zmetalhearty.com/yuanpin/MessageFileUpload",filePath:e.tempFilePath,name:"file",formData:{"content-type":"application/x-www-form-urlencoded"},success:function(e){e.data;var a=i,r="mp3",g="https://zmetalhearty.com"+e.data,c=new n.default.FileMessage({name:a,type:r,fileUrl:g}),l=n.default.ConversationType.PRIVATE;n.default.RongIMClient.getInstance().sendMessage(l,o.targetId,c,{onSuccess:function(e){console.log("发送文件消息成功",e);var n=o.msgList.length-1,a=s(),r=(new Date).getTime();if(o.$store.state.msgList.length>1){n=o.$store.state.msgList.length-1;var i=r-o.$store.state.msgList[n].sentTime}if(i>=6e4){var g={messageType:"system",type:"time",content:a};o.$store.commit("pushMsg",g)}o.$store.commit("pushMsg",e);for(var c=!1,l=0;l<o.$store.state.conversation.length;l++)o.$store.state.conversation[l].targetId==o.targetId&&(c=!0);if(c){for(var u=0;u<o.$store.state.conversation.length;u++)if(o.$store.state.conversation[u].targetId==o.targetId){var m=o.$store.state.conversation;m[u].latestMessage.content.content="[语音]",o.$store.commit("updateConver",m),t.setStorageSync("conversation",m)}t.setStorageSync("msgList"+o.targetId,o.$store.state.msgList);n=o.msgList.length-1;n>7&&(o.scrollToView=o.msgList[n].messageUId)}else o.findCon()},onError:function(t){console.log("发送图片消息失败",t)}})},fail:function(t){console.log("失败")}})}this.willStop=!1},switchVoice:function(){this.hideDrawer(),this.isVoice=!this.isVoice},discard:function(){}}};e.default=r}).call(this,s("543d")["default"])},8766:function(t,e,s){"use strict";(function(t){s("7b0f");n(s("66fd"));var e=n(s("2d3d"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])},"8bce":function(t,e,s){},a5d8:function(t,e,s){"use strict";s.r(e);var n=s("439b"),o=s.n(n);for(var a in n)"default"!==a&&function(t){s.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},ca82:function(t,e,s){"use strict";var n={uniPopup:function(){return s.e("components/uni-popup/uni-popup").then(s.bind(null,"7e3a"))}},o=function(){var t=this,e=t.$createElement,s=(t._self._c,t.__map(t.sendArray,(function(e,s){var n=JSON.parse(e.Comment);return{$orig:t.__get_orig(e),g0:n}})));t.$mp.data=Object.assign({},{$root:{l0:s}})},a=[];s.d(e,"b",(function(){return o})),s.d(e,"c",(function(){return a})),s.d(e,"a",(function(){return n}))}},[["8766","common/runtime","common/vendor"]]]);